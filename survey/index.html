<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DUET by BCAG</title>
    <style>
        /* [保留原本精緻的 CSS 樣式...] */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            background: radial-gradient(circle at 50% 50%, #1c232f 0%, #0a0e14 75%, #000000 100%);
            color: #fff;
            overflow: hidden;
            height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        #control-panel {
            position: absolute; left: 20px; top: 20px; width: 320px;
            max-height: calc(100vh - 40px); overflow-y: auto; padding: 24px;
            border-radius: 20px; z-index: 100;
        }
        /* ...其餘樣式保持不變... */
    </style>
</head>
<body>
    <div id="loader">
        <div class="spinner"></div>
        <div class="loading-text">LOADING STUDIO...</div>
    </div>
    <div id="viewport"></div>
    <script type="module">
        import * as THREE from 'three';
        // ...其餘 import 保持不變...

        const BACKEND_URL = 'https://duet-backend-wlw8.onrender.com';
        
        // 核心：精確的 100 種字體清單
        const allFonts = [
            "Abel", "Abril Fatface", "Advent Pro", "Alegreya", "Alex Brush", 
            "Alfa Slab One", "Alice", "Allura", "Amatic SC", "Amiri", 
            "Anton", "Arapey", "Archivo", "Armata", "Artifika", 
            "Arvo", "Audiowide", "Average", "Baloo 2", "Bangers", 
            "Bebas Neue", "Belgrano", "Bentham", "Bitter", "Bree Serif", 
            "Bubblegum Sans", "Bungee", "Cabin", "Cantata One", "Caudex", 
            "Caveat", "Chivo", "Cinzel", "Comfortaa", "Commissioner", 
            "Cookie", "Copse", "Cormorant Garamond", "Courier Prime", "Coustard", 
            "Creepster", "Cutive Mono", "DM Serif Text", "Dancing Script", "Dosis", 
            "EB Garamond", "Eczar", "Encode Sans", "Fauna One", "Fira Code", 
            "Fira Sans", "Fjalla One", "Fugaz One", "Gelasio", "Gloria Hallelujah", 
            "Great Vibes", "Handlee", "Hind", "Holtwood One SC", "Inconsolata", 
            "Indie Flower", "Jost", "Kalam", "Kanit", "Karla", 
            "Lexend", "Lobster", "Merriweather", "Neuton", "Nunito", 
            "Old Standard TT", "Orbitron", "Oswald", "Outfit", "Pacifico", 
            "Passion One", "Pathway Gothic One", "Patrick Hand", "Paytone One", "Playfair Display", 
            "Poppins", "Prata", "Quicksand", "Righteous", "Rubik", 
            "Russo One", "Sacramento", "Secular One", "Shadows Into Light", "Share Tech Mono", 
            "Shrikhand", "Sniglet", "Space Grotesk", "Space Mono", "Spectral", 
            "Tangerine", "Titan One", "Varela Round", "Vollkorn", "Zilla Slab"
        ];

        let availableFonts = [];

        // 初始化可用字體清單
        async function initAvailableFonts() {
            try {
                const response = await fetch(`${BACKEND_URL}/list-fonts`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                const backendFonts = data.fonts || [];
                
                // 只有當這 100 種字體也在後端時，才允許使用者選取
                availableFonts = allFonts.filter(font => backendFonts.includes(font));
                
                if (availableFonts.length === 0) availableFonts = ['Roboto'];
                console.log(`✅ 字體庫已就緒：${availableFonts.length}/100`);
            } catch (error) {
                console.error('❌ 字體同步失敗:', error);
                availableFonts = allFonts;
            }
        }

        // 分批載入 Google Fonts 確保預覽正常
        function loadGoogleFonts() {
            const batchSize = 30;
            for (let i = 0; i < allFonts.length; i += batchSize) {
                const batch = allFonts.slice(i, i + batchSize);
                const link = document.createElement('link');
                link.href = 'https://fonts.googleapis.com/css2?family=' + 
                            batch.map(f => f.replace(/ /g, '+')).join('&family=') + 
                            '&display=swap';
                link.rel = 'stylesheet';
                document.head.appendChild(link);
            }
        }

        // [其餘 3D 運算與介面邏輯保持不變...]
        // ... (generateModel, initScene, etc.)
    </script>
</body>
</html>